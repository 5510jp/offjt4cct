# 心理的安全性を高めるコードレビューのコメント術

エンジニアの皆さん、 **コードレビュー** はお好きですか？

「自分の書いたコードがより良くなるから大好き!」という方もいれば、「指摘されるのが怖くて、ブルリクエスト (PR) を出すときに心拍数が上がる...」 という方もいるかもしれません。

コードレビューは、バグを防ぎ品質を高めるための重要なプロセスですが、一歩間違えると「人格攻撃」のように受け取られ、チームの心理的安全性を損なう場にもなりかねません。

今回は、レビューする側 (Reviewer) として、**相手のモチベーションを下げず、かつ建設的な議論をするための「コメント術」 **について、私が意識していることをまとめてみました。

## なぜ「心理的安全性」が必要なのか?

Googleの調査でも有名になりましたが、心理的安全性(Psychological Safety) とは 「対人関係のリスクをとっても安全だと信じられる状態」のことです。

コードレビューにおいて心理的安全性が高いと、以下のようなメリットがあります。

* 素直な質問ができる<br>
 「ここ、自信ないんですがどう思います?」と事前に言える。

* バグが減る<br>
  防衛的にならず、指摘を素直に受け入れられる。

* 開発スピードが上がる<br>
  萎縮して手が止まる時間がなくなる。

## 1. 「You」ではなく「We」 や 「The Code」を主語にする

最も基本にして重要なテクニックです。「あなた」を主語にすると、相手は無意識に責められていると感じてしまいます。

主語を「コード」や「私たち」に置き換えましょう。

* 👎 Bad: 「(あなたが)ここでなぜこのメソッドを使っているのか分かりません」

* 👍 Good: 「このロジックだと、エッジケースでエラーになる可能性がありそうです」

* 👍 Good: 「将来的なメンテナンスのために、ここは別クラスに切り出しませんか?」

「あなたが間違っている」のではなく、「コードに改善の余地がある」というスタンスを崩さないことが大切です。

## 2. 「命令」ではなく「提案・質問」にする

断定的な口調は、議論の余地をなくしてしまいます。疑問形や提案形にすることで、相手に考える余地を与えましょう。

* 👎 Bad: 「ここは map を使って書き直してください」

* 👍 Good: 「ここは mop を使ったほうが可読性が上がりそうですが、どう思いますか?」

「どう思いますか?」と聞かれると、相手は「実はパフォーマンスを考慮して for にしたんです」 といった意図を話しやすくなります。

## 3. ラベル (Prefix) を活用して「重要度」を伝える

レビューコメントには、「絶対に直してほしいバグ」から「単なる個人の好み」まで混在しがちです。

これらを区別するために、コメントの先頭にラベルをつけるのがおすすめです。

| ラベル | 意味                 | アクション                                                  |
| ------ | -------------------- | ----------------------------------------------------------- |
| [MUST] | 必須                 | 必ず修正してください(バグ、重大な規約違反など)              |
| [IMO]  | In My Opinion        | の個人的な意見です。修正するかどうかはお任せします          |
| [nits] | nitpick (細かい指摘) | タイボや空白など。修正してもしなくてもOK (でも直すと嬉しい) |
| [ASK]  | 質問                 | 実装の意図を教えてください(修正依頼ではありません)          |

特に [IMO] や [nits] を明示することで、「全部直さなきゃ…..」 というレビュイーのプレッシャーを大幅に減らすことができます。

## 4. 良いところは積極的に褒める!

これが一番忘れがちですが、一番効果的です。指摘事項ばかりが並ぶと、どんなにベテランでも 「自分はダメなコードを書いたんだ...」と凹みます。

* ✨「この実装、エレガントですね!」

* ✨「複雑なロジックをシンプルに落とし込んでいて読みやすいです」

* ✨「エッジケースの考慮が漏れなくて素晴らしい!」

* ✨ (リファクタリングに対して) 「ここ掃除してくれてありがとう! 助かります」

「LGTM」ボタンを押す前に、最低1つは「良いところ」を見つけてコメントする。これをチームの習慣にするだけで、雰囲気は劇的に良くなります。

## 5.「意図」を説明する

単に「直して」と言うだけでなく、「なぜ直すべきか」の理由 (Why) を添えましょう。

* 👎 Bad: 「変数名は userList に変えてください」

* 👍 Good: 「data だと中身が何か分かりにくいため、後から読む人が迷わないよう userList のほうが良さそうです」

理由があれば、相手も納得感を持って修正できますし、チーム全体の技術力向上 (教育)にもつながります。

## まとめ: コードレビューは「間違い探し」ではなく「チームビルディング」

コードレビューの目的は、コードの品質を上げることですが、それと同じくらい **「チームで協力してプロダクトを作る」** というプロセスそのものが重要です。

* 相手を尊重する: コードの問題と人格を切り離す。

* 問いかける: 命令せず、意図を聞いたり提案したりする。

* 称賛(感謝)する: 良いコードには「いいね！」を伝える。

これらを少し意識するだけで、PR上のコメント欄が「戦場」から「教室」や「作戦会議室」のようなポジティブな場所に変わります。

私自身も忙しいとつい雑なコメントになりがちなので、自戒を込めてこの記事を書きました。

皆さんの「レビューで気をつけていること」があれば、ぜひ教えてください!

## おまけ： すぐに使える言い換え例

| シチュエーション | 😱 怖いコメント（NG） | 🤝 心理的安全性の高いコメント（OK） |
| :--- | :--- | :--- |
| **バグの指摘** | 「ここバグってます。修正してください。」 | 「特定の条件下でエラーになる懸念がありそうです。一度 `null` のケースを確認してみてもらえますか？」 |
| **実装意図の確認** | 「なんでこんな実装にしたの？」 | 「このロジックを採用した意図を教えていただけますか？（背景を理解したいです）」 |
| **好みの問題** | 「書き直して。」 | 「**IMO（私の意見ですが）**、こちらの書き方の方が可読性が高まりそうです。どう思いますか？」 |
| **不要なコード** | 「これ要らないので消して。」 | 「この行はデバッグ用でしょうか？ 本番環境には不要に見えますが、意図があれば教えてください。」 |
| **複雑なロジック** | 「この `if` 文のネスト、深すぎて読めません。もっと単純に書いてください。」 | 「この部分はロジックが少し複雑で、将来他のメンバーが修正する時に迷うかもしれません。早期リターンを使ってネストを浅くすると読みやすくなりそうですが、どうでしょうか？」 |
| **パフォーマンス** | 「ループの中でSQL投げないでください。サイトが重くなります。」 | 「ここではループの回数分クエリが発行されるようです。負荷軽減のため、IDリストを使って一括取得（`IN` 句など）する形にリファクタリングするのはいかがでしょうか？」 |
| **エラー処理** | 「エラーハンドリングが雑です。失敗した時のことを考えてないですよね？」 | 「APIサーバーがダウンしている時の挙動について確認させてください。ユーザーにメッセージを出す処理を追加するのはどう思いますか？」 |


